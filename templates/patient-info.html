<div class="row">
  <h1 class="col-md-12">{{ patient.user.first_name }} {{ patient.user.last_name }}</h1>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="panel panel-default">
      <table class="table table-responsive table-bordered">
        <tr>
          <td width="120px">Personnummer</td>
          <td>{{ patient.national_identification_number }}</td>
        </tr>
        <tr>
          <td>Alder</td>
          <td>{{ patient.age }} {{ patient.age ? 'år' : 'Ukjent' }}</td>
        </tr>
        <tr>
          <td>Telefonnummer</td>
          <td>
            {{ patient.phone_number }}
            <i ng-hide="patient.phone_number">Ikke spesifisert</i>
          </td>
        </tr>
        <tr>
          <td>Adresse</td>
          <td>
            <i ng-hide="patient.address || patient.zip_code || patient.city">Ingen adresse er spesifisert</i>
            <a ng-href="http://maps.google.com/?q={{patient.address}}, {{patient.zip_code}} {{patient.city}}, Norway"
               target="_blank">
              {{ patient.address }}{{ (patient.zip_code || patient.city) ? ', ' : '' }}{{ patient.zip_code }} {{ patient.city }}
            </a>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="col-md-6">
    <div class="panel panel-default panel-body" ng-if="!patient.next_of_kin.length">
      Ingen pårørende er registrert
    </div>
    <div class="panel panel-default" ng-repeat="contact in patient.next_of_kin | limitTo: nextOfKinLimit">
      <div class="panel-body" ng-class="{ 'main-next-of-kin': $index === 0 }">
        <p ng-show="$index === 0"><span class="glyphicon glyphicon-star"></span> Hovedpårørende:</p>
        <p ng-hide="$index === 0">Pårørende:</p>
        <p class="list-group-item-heading">
          <span class="glyphicon glyphicon-user"></span>
          {{ contact.full_name }} <span class="label label-info" ng-show="contact.relation">{{ contact.relation }}</span>
        </p>
        <p class="list-group-item-text" ng-show="contact.phone_number">
          <span class="glyphicon glyphicon-earphone"></span> {{ contact.phone_number }}
        </p>
        <p class="list-group-item-text" ng-show="contact.address">
          <span class="glyphicon glyphicon-map-marker"></span>
          <a ng-href="http://maps.google.com/?q={{contact.address}}" target="_blank">{{ contact.address }}</a>
        </p>
      </div>
    </div>
    <button class="btn btn-default" ng-click="showAllNextOfKin()"
            ng-if="nextOfKinLimit === 1 && patient.next_of_kin.length > 1">Vis alle pårørende</button>
  </div>
</div>

<h4>Varsler:</h4>
<div class="loading-spinner loading-spinner-medium" ng-if="loadingAlarms && !loadingPatient"></div>
<alert ng-show="!loadingAlarms && 0 === alarms.length" type="success">
  <span class="glyphicon glyphicon-ok"></span> Ingen varsler
</alert>
<alert type="danger" ng-show="!loadingAlarms && !alarms">Kunne ikke laste inn varsler</alert>
<table class="table table-bordered table-striped table-hover table-responsive" ng-if="alarms.length > 0">
  <tr>
    <th>Tid</th>
    <th>Type</th>
    <th>Håndtert</th>
    <th>Endre/håndter</th>
    <th>Notis</th>
    <th>Søkeord</th>
  </tr>
  <tr ng-repeat="alarm in alarms">
    <td>{{ alarm.time_created | date : 'dd.MM.yyyy HH:mm' }}</td>
    <td>{{ alarm.is_measurement_too_high ? 'Høy' : 'Lav' }} {{ measurementType[alarm.measurement.type] }}</td>
    <td>
      <span ng-if="alarm.is_treated">
        <span class="glyphicon glyphicon-ok iconGreen"></span> Ja
      </span>
      <span ng-if="!alarm.is_treated">
        <span class="glyphicon glyphicon-warning-sign iconRed"></span> Nei
      </span>
    </td>
    <td>
      <button class="btn btn-default" ng-click="open(null, $index)">
        <span class="glyphicon glyphicon-edit"></span>
        <span ng-if="alarm.is_treated">Endre</span>
        <span ng-if="!alarm.is_treated">Merk som håndtert</span>
      </button>
    </td>
    <td>{{ alarm.treated_text }}</td>
    <td>{{ alarm.search_tag }}</td>
  </tr>
</table>

<div class="panel panel-success">
  <div class="panel-heading">
    <h3 class="panel-title">Motiverende beskjeder:</h3>
  </div>
  <div ng-repeat="motivationalText in patient.motivation_texts">
    <div class="panel-body">
      {{motivationalText.text}}
    </div>
  </div>
</div>

<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">Informative beskjeder:</h3>
  </div>
  <div ng-repeat="informationalText in patient.information_texts">
    <div class="panel-body">
      {{informationalText.text}}
    </div>
  </div>
</div>
